<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.smhrd.model.ProductDAO">
	
	<!--해외공구상품 등록 -->
	<insert id="OPupload" parameterType="com.smhrd.model.ProductVO">
		insert into product values(
		product_SEQ.nextval,#{prod_name},#{prod_cate},#{prod_price},#{prod_title},
		#{prod_img1},#{prod_img2},#{prod_desc},'0','0',sysdate,#{number_of_people},
		#{customs_clearance_num},#{seller_id},'0', #{return_period},'0')
	</insert>
	
	 <!--해외공구상품 출력-->
	 <!--prod_check=0(해외공구상품) prod_check=1(중고거래 상품)-->
	<select id="OPshow" resultType="com.smhrd.model.ProductVO">
		select * from product where prod_check='0' 		 
	</select>
	
	 <!--상품 상세정보 페이지 -->
	<select id="ShowProdDetail" resultType="com.smhrd.model.ProductVO" parameterType="int">
		select * from PRODUCT where prod_num=#{prod_num}
	</select>
	
	<!-- 로그인한 유저의 상품 장바구니 조회  -->
  	 <select id = "Bucket" resultType="com.smhrd.model.ProductVO" parameterType = "String">
		select T1.*, T.* from PRODUCT T1
		JOIN BUCKET T
		ON T1.PROD_NUM = T.PROD_NUM
		AND T.u_id = #{u_id} where order_status='N'
  	 </select>
  	 
  	<!--장바구니에 담아놓은 상품 결제완료시 구매한 사람 수 업데이트 -->
	<update id="buyerCntUpdate" parameterType="String" >
		MERGE INTO product p
        USING (SELECT prod_num, amount FROM bucket WHERE order_status = 'Y' and u_id=#{u_id}) b
        ON (p.prod_num = b.prod_num)
        WHEN MATCHED THEN UPDATE SET p.buyer_cnt = b.amount
	</update>
	
</mapper>	